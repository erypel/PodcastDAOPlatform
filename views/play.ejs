<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Play</title>
</head>
<body>
	<script src="https://unpkg.com/wavesurfer.js"></script>
	<div id="waveform"></div>
	<p align="center">
  <button class="btn btn-primary" onclick="wavesurfer.playPause()">
    <i class="glyphicon glyphicon-play"></i>
    Play
  </button>
</p>
	<br>
	<form action="/podcast" method = "get">
          <button>Back</button>
    </form> 
	<form action="/logout" method = "get">
          <button>Logout</button>
    </form>
    <script type="text/javascript">
    
    // taken from authentication. need to refactor
    function post (path, data) {
  		return window.fetch(path, {
    	method: 'POST',
    	headers: {
      		'Accept': 'application/json',
      		'Content-Type': 'application/json'
    	},
    	body: JSON.stringify(data)
  	})
}

    let wavesurfer = WaveSurfer.create({
	    container: '#waveform',
	    waveColor: 'violet',
	    progressColor: 'purple'
	})
	let a = "<%=adPath%>"
	let p = "<%=epPath%>"
	let autoPlay = true
	//need to run `http-server --cors` for access to file server
	//if there's a linked ad
	if(a){
		wavesurfer.load("uploads/" + a)
		wavesurfer.on('ready', function () {
			wavesurfer.play();
		})
		let playNext = true
		wavesurfer.on('finish', function() {
			if(playNext){
				post('/payAuthor', {
					campaignID: '<%=campaignID%>',
					adID: '<%=adID %>',
					podcastID: '<%=podcastID %>'
				})
				wavesurfer.load("uploads/" + p)
				playNext = false;	
			}
		})
	}
	//if there is no linked ad
	else{
		wavesurfer.load("uploads/" + p)
		wavesurfer.on('ready', function () {
			wavesurfer.play();
		})
	}
	
    </script>
</body>
</html>